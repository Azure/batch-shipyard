desc: Global Configuration Schema

type: map
mapping:
  batch_shipyard:
    type: map
    required: true
    mapping:
      storage_account_settings:
        type: str
        required: true
      storage_entity_prefix:
        type: str
      generated_sas_expiry_days:
        type: int
      autogenerated_task_id:
        type: map
        mapping:
          prefix:
            type: str
          zfill_width:
            type: int
      encryption:
        type: map
        mapping:
          enabled:
            type: bool
          pfx:
            type: map
            mapping:
              filename:
                type: str
                required: true
              passphrase:
                type: str
                required: true
              sha1_thumbprint:
                type: str
          public_key_pem:
            type: str

  data_replication:
    type: map
    mapping:
      concurrent_source_downloads:
        type: int
      peer_to_peer:
        type: map
        mapping:
          enabled:
            type: bool
          compression:
            type: bool
          direct_download_seed_bias:
            type: int

  global_resources:
    type: map
    mapping:
      additional_registries:
        type: map
        mapping:
          docker:
            type: seq
            sequence:
              - type: str
          singularity:
            type: seq
            sequence:
              - type: str
      docker_images:
        type: seq
        sequence:
          - type: str
      singularity_images:
        type: seq
        sequence:
          - type: str
      volumes:
        type: map
        mapping:
          data_volumes:
            type: map
            mapping:
              regex;([a-zA-Z0-9]+):
                type: map
                mapping:
                  container_path:
                    type: str
                  host_path:
                    type: str
                  bind_options:
                    type: str
                    enum: ['ro', 'rw']
          shared_data_volumes:
            type: map
            mapping:
              regex;([a-zA-Z0-9]+):
                type: map
                mapping:
                  volume_driver:
                    type: str
                    enum: ['azurefile', 'glusterfs_on_compute', 'storage_cluster']
                    required: true
                  container_path:
                    type: str
                    required: true
                  storage_account_settings:
                    type: str
                  azure_file_share_name:
                    type: str
                  mount_options:
                    type: seq
                    sequence:
                      - type: str
                  volume_type:
                    type: str
                    enum: ['replica']
                  volume_options:
                    type: seq
                    sequence:
                      - type: str
                  bind_options:
                    type: str
                    enum: ['ro', 'rw']
      files:
        type: seq
        sequence:
          - type: map
            mapping:
              destination:
                type: map
                mapping:
                  relative_destination_path:
                    type: str
                  shared_data_volume:
                    type: str
                  storage_account_settings:
                    type: str
                  data_transfer:
                    type: map
                    mapping:
                      method:
                        type: str
                        enum: ['multinode_rsync+ssh', 'multinode_scp', 'rsync+ssh', 'scp']
                      ssh_private_key:
                        type: str
                      scp_ssh_extra_options:
                        type: str
                      rsync_extra_options:
                        type: str
                      split_files_megabytes:
                        type: int
                      max_parallel_transfers_per_node:
                        type: int
                      remote_path:
                        type: str
                      is_file_share:
                        type: bool
                      blobxfer_extra_options:
                        type: str
              source:
                type: map
                mapping:
                  exclude:
                    type: seq
                    sequence:
                      - type: str
                  include:
                    type: seq
                    sequence:
                      - type: str
                  path:
                    type: str
                    required: true
