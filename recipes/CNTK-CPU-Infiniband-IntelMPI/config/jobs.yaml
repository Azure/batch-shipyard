job_specifications:
- id: cntkjob
  auto_complete: true
  shm_size: 256m
  tasks:
  - docker_image: alfpark/cntk:2.1-cpu-1bitsgd-py36-intelmpi-refdata
    resource_files:
    - blob_source: https://raw.githubusercontent.com/Azure/batch-shipyard/master/recipes/CNTK-CPU-Infiniband-IntelMPI/docker/set_up_task.sh
      file_path: set_up_task.sh
    multi_instance:
      num_instances: pool_current_dedicated
      pre_execution_command: source set_up_task.sh
      mpi:
        runtime: intelmpi
        processes_per_node: 1
    command: /bin/bash -i -c "python -u /cntk/Examples/Image/Classification/ConvNet/Python/ConvNet_CIFAR10_DataAug_Distributed.py -q 1 -datadir /cntk/Examples/Image/DataSets/CIFAR-10 -outputdir $AZ_BATCH_TASK_WORKING_DIR/output"
